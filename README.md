# IoTë¥¼ í™œìš©í•œ ìˆ˜ìœ„ ì¡°ì ˆ ì‹œìŠ¤í…œ
## ì§„í–‰ê¸°ê°„ : 2021-04-13 ~ 2021-11-30

### ğŸŒ§ ë‚˜ëŠ” ì¥ë§ˆê°€ ì‹«ì–´ íŒ€
|íŒ€ì›|ì—­í• |
|---|---|
|ë°•ë™ë¯¼ ğŸ”µ |íŒ€ì¥(Project Manager), H/W, S/W, 3D Print|
|ì¥ìƒê·  ğŸŸ¢ |Web, App, DB, SMS, S/W, 3D Print|

### ì‚¬ìš©ê¸°ìˆ 
---
+ <img src="https://img.shields.io/badge/C++-00599C?style=flat-square&logo=C%2B%2B&logoColor=white"/> <img src="https://img.shields.io/badge/C-A8B9CC?style=flat-square&logo=C&logoColor=white"/> <img src="https://img.shields.io/badge/Arduino-00979D?style=flat-square&logo=Arduino&logoColor=white"/> <img src="https://img.shields.io/badge/Node.js-339933?style=flat-square&logo=Node.js&logoColor=white"/> - ê°œë°œ ì–¸ì–´
+ <img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white"/> - í˜•ìƒê´€ë¦¬
+ ![app icon](https://user-images.githubusercontent.com/58980007/146013473-85e258d5-2b7d-464c-8215-f642c8ae2b78.png) - Application ì œì‘
+ <img src="https://img.shields.io/badge/Firebase-FFCA28?style=flat-square&logo=Firebase&logoColor=white"/> â€“ Realtime Database
+ ![whois icon](https://user-images.githubusercontent.com/58980007/146014071-7b971618-8429-474b-a706-a41e6e683fa5.png) - SMS ì„œë¹„ìŠ¤
+ <img src="https://img.shields.io/badge/Raspberry Pi-A22846?style=flat-square&logo=Raspberry Pi&logoColor=white"/> - LCD íŒ¨ë„
+ <img src="https://img.shields.io/badge/Autodesk-0696D7?style=flat-square&logo=Autodesk&logoColor=white"/> - Fusion 360

### ì„¤ëª…
---
+ 2021 í•œì´ìŒ ICT ë©˜í† ë§ì—ì„œ ì§„í–‰ í–ˆë˜ íŒ€ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.
+ ìµœê·¼ ì´ìƒê¸°í›„ ë•Œë¬¸ì— ì¥ë§ˆì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ë¹„ê°€ êµ­ì§€ì„± ì§‘ì¤‘í˜¸ìš°ì™€ ê°™ì´ ì§§ì€ ì‹œê°„ì— ë§ì´ ë‚´ë ¤ì„œ ë°œìƒí•˜ëŠ” ì¹¨ìˆ˜ í”¼í•´ë¥¼ ë°©ì§€í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
+ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ë‹´ë‹¹ìì—ê²Œ ìœ„í—˜ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
+ Applicationë¥¼ í†µí•´ ì›ê²©ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê¸°ëŠ¥
---
- Applicationì„ ì´ìš©í•œ íŒí”„ ì›ê²© ì œì–´ (Firebase, App Inventer)
- íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡± ì‹œ SMS ì„œë¹„ìŠ¤ APIë¥¼ í†µí•´ ë©”ì‹œì§€ ì „ì†¡
- Applicationê³¼ ESP8266ì˜ ì„œë²„ë¥¼ í†µí•œ í†µì‹  ë° ë°ì´í„° ì „ì†¡
- ESP32ì™€ ë ˆì´ì € ì„¼ì„œë¥¼ í†µí•œ ê±°ë¦¬ ì¸¡ì •
- Relayë¥¼ ì´ìš©í•œ íŒí”„ ì œì–´ ë° ì‘ë™

### ê°œë°œ ê¸°íš
---
- ìµœê·¼ ì´ìƒê¸°í›„ ë•Œë¬¸ì— ì—¬ë¦„ ì¥ë§ˆì² ì´ ë˜ë©´ ì €ì§€ëŒ€ì— ìœ„ì¹˜í•œ ì•„íŒŒíŠ¸ë“¤ì´ ì§€í•˜ì—ì„œ ë¬¼ì´ ë„˜ì³ì„œ í”¼í•´ë¥¼ ë³´ëŠ” ì¼ì„ ë‰´ìŠ¤ë¥¼ í†µí•´ ìì£¼ ë³´ê²Œ ë˜ì—ˆë‹¤. ê¸°ì¡´ì— ì„¤ì¹˜ë˜ì–´ ìˆëŠ” íŒí”„ê°€ ì—¬ëŸ¬ ì œì•½ ë•Œë¬¸ì— ì •ìƒ ì‘ë™í•˜ì§€ ì•Šì•„ ìƒê¸°ëŠ” ì¹¨ìˆ˜ í”¼í•´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë²”ëŒ ë°©ì§€ ìë™ ìˆ˜ìœ„ ì¡°ì ˆ íŒí”„ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ ë¬¼ì´ ë„˜ì³íë¥´ëŠ” ì¼ì´ ì—†ë„ë¡ ì œì–´í•  í•„ìš”ê°€ ìˆë‹¤.


## ì†ŒìŠ¤ì½”ë“œ
### Main System - esp8266_button.ino
```C
#include "Arduino.h"
#include "PCF8574.h"
#include "math.h"
PCF8574 pcf20(0x20); 

//PCF8574 pcf8574(0x20, D2(5), D1(4)); //PCF8574(ì£¼ì†Œ ê°’, SDA, SCL)

//LCD
#include <LiquidCrystal_I2C.h>
LiquidCrystal_I2C lcd(0x27,16,2);

int initial = 0; //ì´ˆê¸° ê±°ë¦¬ ì €ì¥ ë³€ìˆ˜
int current = 0; //í˜„ì¬ ê±°ë¦¬ ì €ì¥ ë³€ìˆ˜
int count = 0; //ìˆ˜ìœ„ ì¡°ê±´ ì¶©ì¡± ë³€ìˆ˜
int mes = 0; // ë©”ì„¸ì§€ ì „ì†¡ ë³€ìˆ˜
int avg = 0; // ë ˆì´ì €ì„¼ì„œê°’ í‰ê·  ë³€ìˆ˜

//ESP8266
#include <Wire.h>
#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>

// ë°ì´í„°ë² ì´ìŠ¤,ì™€ì´íŒŒì´ ì„¤ì • 
#include <FirebaseESP8266.h>  //https://github.com/mobizt/Firebase-ESP8266
#define FIREBASE_HOST "esp8266-sensor-readings-23fd0-default-rtdb.firebaseio.com"
#define FIREBASE_Authorization_key ""
FirebaseData firebaseData;
FirebaseJson json;
// ë°ì´í„°ë² ì´ìŠ¤ ON/OFF í‘œì‹œ auto, pump ë³€ìˆ˜
String autoval; // AUTOëª¨ë“œ ë³€ìˆ˜
String pumpval; // PUMPëª¨ë“œ ë³€ìˆ˜
String ONval = "\\\"ON\\\""; //ON ê°’ ì €ì¥
String OFFval = "\\\"OFF\\\""; // OFF ê°’ ì €ì¥

const char* ssid = "wong";
const char* password = "12340000";
//const char* ssid = "iptimea704";
//const char* password = "rodemeng2019";
WiFiServer server(80);

//switch or led
int bluePin = P0;
int greenPin = P1;
int redPin = P2;
const int button1 = P3; //ì´ˆê¸° ê°’
const int button2 = P4; //Auto Mode
const int button3 = P5; //Pump

//íŒí”„
const int pump = 14;

void setup() {
    Serial.begin(115200);
    
    Wire.begin();
    Wire.setClock(400000); // use 400 kHz I2C
    WiFi.begin(ssid, password);
    
    while (WiFi.status() != WL_CONNECTED) {
      delay(1000);
      Serial.println("Connecting..");    
    }
    
    Serial.println("ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");

    server.begin();
    Serial.println("Server started");
    Serial.print("Use this URL to connect: ");
    Serial.print("http://");
    Serial.print(WiFi.localIP());
    Serial.println("/");
    //WIFI ì—°ê²° í›„ íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²° 
    Firebase.begin(FIREBASE_HOST,FIREBASE_Authorization_key);
    Serial.println("Firebase connect");
    //íŒŒì´ì–´ë² ì´ìŠ¤ DB OFFë¡œ ì´ˆê¸°í™”, ì´ˆê¸°ê°’ 0ì„¤ì •
    Firebase.setString(firebaseData, "/testPump_in_server_DB/AUTO", OFFval);
    Firebase.setString(firebaseData, "/testPump_in_server_DB/PUMP", OFFval);
    Firebase.setFloat(firebaseData, "/testPump_in_server_DB/INI", initial);
    autoval = OFFval; // ì‹œì‘í•  ë•Œ auto OFF
    pumpval = OFFval; // ì‹œì‘í•  ë•Œ pump OFF
    
    pinMode(pump, OUTPUT);
  
    pcf20.pinMode(button1, INPUT_PULLUP);
    pcf20.pinMode(button2, INPUT);
    pcf20.pinMode(button3, INPUT);
    pcf20.pinMode(redPin, OUTPUT);
    pcf20.pinMode(greenPin, OUTPUT);   
    pcf20.pinMode(bluePin, OUTPUT);        
    pcf20.begin(); //ì²˜ìŒì— ì•ˆì¨ì„œ ì‹¤í–‰ ì•ˆë¨(ì£¼ì˜)

    lcd.init(); // LCD ì„¤ì •
    lcd.clear();      // LCDë¥¼ ëª¨ë‘ ì§€ìš´ë‹¤.
    lcd.backlight();  // ë°±ë¼ì´íŠ¸ë¥¼ ì¼ ë‹¤. 
    // ì‹œìŠ¤í…œ, íŒ€ëª…, ì´ë¦„ í‘œì‹œ     
    lcd.setCursor(0,0);
    lcd.print("Flood Protection");
    delay(1500);
    lcd.setCursor(0,1);
    lcd.print("Auto Pump System");
    delay(1500);
    lcd.clear();
//    lcd.setCursor(0,0);
//    lcd.print("I do not like"); 
//    delay(1500);
//    lcd.setCursor(0,1);
//    lcd.print("The rainy season");
//    delay(1500);
//    lcd.clear();
//    lcd.setCursor(0,0);
//    lcd.print("Dong Min Park");
//    delay(1500);
//    lcd.setCursor(0,1);
//    lcd.print("Sang Gyun Jang");
//    delay(1500);
}


void loop() {  
  setColor(1, 0, 1); //ë…¹    

  WiFiClient client = server.available();
  //ë ˆì´ì €ì„¼ì„œê°’ ë°›ì•„ì˜¤ê¸°
  Firebase.getInt(firebaseData, "/testPump_in_server_DB/DISTANCE");
  avg = firebaseData.intData();

  if(pcf20.digitalRead(button1)==LOW){
    initial = avg;
    Firebase.setFloat(firebaseData, "/testPump_in_server_DB/INI", avg);
    Serial.print("ì´ˆê¸° ê°’ì€ "); 
    Serial.print(initial); 
    Serial.println(" mm ì…ë‹ˆë‹¤.");
    setColor(1, 0, 0); //ì²­ë¡    
    lcd.clear(); 
    lcd.setCursor(0,0);
    lcd.print("Initial Distance");
    lcd.setCursor(0,1); 
    lcd.print(initial);
    lcd.print(" mm");
    delay(1000);    
  }

  Firebase.getString(firebaseData, "/testPump_in_server_DB/AUTO");
  autoval = firebaseData.stringData();     
  Firebase.getString(firebaseData, "/testPump_in_server_DB/PUMP");
  pumpval = firebaseData.stringData();
    
  if(autoval == ONval){
    pcf20.digitalWrite(button2, HIGH);
    }
  if(autoval == OFFval){
    pcf20.digitalWrite(button2, LOW);
    }
  if(pumpval == ONval){
    pcf20.digitalWrite(button3, HIGH);
    }
  if(pumpval == OFFval){
    pcf20.digitalWrite(button3, LOW);
    }
    
  if(pcf20.digitalRead(button2)==HIGH){ //ìë™ëª¨ë“œ
    Serial.println("ìë™ëª¨ë“œ ì…ë‹ˆë‹¤.");
    setColor(1, 1, 0); //íŒŒ   
    lcd.clear(); 
    lcd.setCursor(0,0);
    lcd.print("Auto Mode");
    if(autoval == OFFval && pumpval == OFFval){
      Firebase.setString(firebaseData, "/testPump_in_server_DB/APPAUTO", ONval);
    }
    delay(1000);  

    /////////// ìë™ëª¨ë“œì´ë©´ ìë™ìœ¼ë¡œ íŒí”„ ì‘ë™///////////////
    if(avg < (initial/10*6)){
      Serial.println("íŒí”„ ì‘ë™");
      Serial.println("ìˆ˜ìœ„ê°€ 50%ì´ìƒ ì°¼ìŠµë‹ˆë‹¤.");
      digitalWrite(pump, HIGH);
      setColor(0, 1, 1); //ë¹¨      
      lcd.clear(); 
      lcd.setCursor(0,1);
      lcd.print("Pump ON");
      if(autoval == ONval){
        Firebase.setString(firebaseData, "/testPump_in_server_DB/NOWMAIN", ONval); 
      }
      else{
        Firebase.setString(firebaseData, "/testPump_in_server_DB/NOWMAIN", ONval); 
      }
      delay(1000);
    }
    else if(initial != 0 && avg > (initial/2)){
      Serial.println("íŒí”„ ì¤‘ì§€");
      digitalWrite(pump, LOW);
      setColor(1, 1, 1); //off
      lcd.clear(); 
      lcd.setCursor(0,1);
      lcd.print("Pump OFF");
      if(digitalRead(pump) == LOW && autoval == ONval){
        Firebase.setString(firebaseData, "/testPump_in_server_DB/NOWMAIN", OFFval);     
      }else if(digitalRead(pump) == LOW && digitalRead(button2) == HIGH){
        Firebase.setString(firebaseData, "/testPump_in_server_DB/NOWMAIN", OFFval); 
      }
      delay(1000);
    }

    if(avg < (initial/10*4)){
      Serial.println("ìˆ˜ìœ„ê°€ 60%ì´ìƒ ì°¼ìŠµë‹ˆë‹¤.");
      count++;
    }
    if(count==5){
      mes=1;
      count=0;
    }
    //---------------------------- ë¬¸ì ì „ì†¡ íˆ´
    //ë¬¸ì ì…ë ¥ì‹œì— ë„ì–´ì“°ê¸°ëŠ” %20ìœ¼ë¡œ ì‘ì„±í•´ì•¼í•¨. ì•„ë‹ˆë©´ ì‘ë™X
    //Ex) ë¬¸ì%20í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. -> ë¬¸ì í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. 
    String message = "http://www.all-tafp.org/EmmaSMS_PHP_UTF-8_JSON/example.php?sms_msg=ìˆ˜ìœ„60%ì´ìƒ!%20ìˆ˜ìœ„60%ì´ìƒ!%20ì§€ê¸ˆ%20ì¦‰ì‹œ%20í˜„ì¥ìœ¼ë¡œ%20ì™€ì£¼ì‹œê¸°ë°”ëë‹ˆë‹¤.&sms_to=010-8338-2385&sms_from=010-8338-2385&sms_date=";
    if(mes == 1){
      Serial.println("ë©”ì„¸ì§€ ë³´ëƒ„");
      Serial.println("ìˆ˜ìœ„ 60%ì´ìƒ ì¦‰ì‹œ í˜„ì¥ìœ¼ë¡œ!!");
      lcd.clear();
      lcd.setCursor(0,0);
      lcd.print("send mes");
      delay(3000);
      lcd.clear();        
      if (WiFi.status() == WL_CONNECTED) { //Check WiFi connection status
        HTTPClient http;  //Declare an object of class HTTPClient
        
        http.begin(message);  //Specify request destination
        int httpCode = http.GET(); 
      
        Serial.println("ì½”ë“œ ì‹¤í–‰");
        for(int i=40; i>0; i--){
          lcd.setCursor(0,0);
          lcd.print("waiting signal");
          lcd.setCursor(0,1);
          lcd.print(i);
          delay(1000);
          lcd.clear();
        }           
      } 
    }//mes
  
    if(mes==1){
      mes=0;
    }
  }//button2(AUTO) == HIGH
  
  else {  //ìˆ˜ë™ëª¨ë“œ
    Serial.println("ìˆ˜ë™ëª¨ë“œ ì…ë‹ˆë‹¤.");
    setColor(1, 1, 1); //off    
    lcd.clear(); 
    lcd.setCursor(0,0);
    lcd.print("Auto Mode OFF");
    if(autoval == OFFval && pumpval == OFFval){
     Firebase.setString(firebaseData, "/testPump_in_server_DB/APPAUTO", OFFval); 
    }     
    delay(1000);

    /////////// ìˆ˜ë™ëª¨ë“œì´ë©´ ìˆ˜ë™ìœ¼ë¡œ íŒí”„ ì‘ë™///////////////
    if(pcf20.digitalRead(button3)==HIGH && pcf20.digitalRead(button2)==LOW){      
      Serial.println("íŒí”„ ì‘ë™");      
      digitalWrite(pump, HIGH);
      setColor(0, 1, 1); //ë¹¨
      lcd.clear(); 
      lcd.setCursor(0,1);
      lcd.print("Pump ON");
      if(autoval == OFFval && pumpval == OFFval){
        Firebase.setString(firebaseData, "/testPump_in_server_DB/APPPUMP", ONval); 
      } 
      
      delay(1000);
    }
    else if(pcf20.digitalRead(button3)==LOW){ 
      Serial.println("íŒí”„ ì¤‘ì§€");
      digitalWrite(pump, LOW);
      setColor(1, 1, 1); //off
      lcd.clear(); 
      lcd.setCursor(0,1);
      lcd.print("Pump OFF");
      if(autoval == OFFval && pumpval == OFFval){
        Firebase.setString(firebaseData, "/testPump_in_server_DB/APPPUMP", OFFval); 
      }   
      delay(1000);
    } 
  }//ìˆ˜ë™ëª¨ë“œ
} //loop

void setColor(int red, int green, int blue)
{
  pcf20.digitalWrite(redPin, red);
  pcf20.digitalWrite(greenPin, green);
  pcf20.digitalWrite(bluePin, blue); 
}
```
ë©”ì¸ ì‹œìŠ¤í…œ ì†ŒìŠ¤ì½”ë“œì´ë‹¤. íŒí”„ë¥¼ ì œì–´í•˜ê³  Firebaseì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ê³  Applicationì„ í†µí•´ ì›ê²©ìœ¼ë¡œ ì œì–´í•˜ë©° ìœ„í—˜ ìƒí™©ì‹œ SMSë¥¼ ì „ì†¡í•œë‹¤.

### Laser Sensor - esp32_laser_Nopcf.ino
```C
#include "Arduino.h"
#include "PCF8574.h"
#include "math.h"

PCF8574 pcf21(0x21);
//PCF8574 pcf8574(0x20, 21, 22)); //PCF8574(ì£¼ì†Œ ê°’, SDA, SCL)


//VL53L1X
#include <VL53L1X.h> //Download this library from https://github.com/pololu/vl53l1x-arduino
int avg = 0; // ë ˆì´ì €ì„¼ì„œê°’ í‰ê·  ë³€ìˆ˜

/////////// 2mì§œë¦¬ ë ˆì´ì € í…ŒìŠ¤íŠ¸/////////////
//#include <VL53L0X.h>
//VL53L0X sensor;
//////////////////////////////////////


//ë ˆì´ì €ì„¼ì„œ 5ê°œ
VL53L1X sensor_A; //Create the sensor object
VL53L1X sensor_B; //Create the sensor object
VL53L1X sensor_C; //Create the sensor object
VL53L1X sensor_D; //Create the sensor object
VL53L1X sensor_E; //Create the sensor object
 
int startTime = millis(); //used for our timing loop
int mInterval = 100; //refresh rate of 10hz
 
#define XSHUT_A 27 // GPIO27 ESP32 ìˆœì„œëŒ€ë¡œ ë„£ì€ê±°ì„
#define XSHUT_B 26 // GPIO26
#define XSHUT_C 25 // GPIO25
#define XSHUT_D 33 // GPIO33
#define XSHUT_E 32 // GPIO32
//#define Raspberry_pi P5 //pcf21
 
#define M_INTERVAL 50

//ESP8266
#include <Wire.h>
//#include <WiFiClient.h>
#include <WiFi.h>

//#include <ESP8266HTTPClient.h>

// ë°ì´í„°ë² ì´ìŠ¤,ì™€ì´íŒŒì´ ì„¤ì • 
#include <FirebaseESP32.h>  //https://github.com/mobizt/Firebase-ESP32
#define FIREBASE_HOST "esp8266-sensor-readings-23fd0-default-rtdb.firebaseio.com"
#define FIREBASE_Authorization_key "GzVRIYoR2qjjvtMmrpS2Z4Esl089LWlCxYxcQRFv"
FirebaseData firebaseData;
FirebaseJson json;
// ë°ì´í„°ë² ì´ìŠ¤ ON/OFF í‘œì‹œ auto, pump ë³€ìˆ˜
String autoval; // AUTOëª¨ë“œ ë³€ìˆ˜
String pumpval; // PUMPëª¨ë“œ ë³€ìˆ˜
String ONval = "\\\"ON\\\""; //ON ê°’ ì €ì¥
String OFFval = "\\\"OFF\\\""; // OFF ê°’ ì €ì¥

const char* ssid = "wong";
const char* password = "12340000";
//const char* ssid = "iptimea704";
//const char* password = "rodemeng2019";
WiFiServer server(80);



void setup() {
    Serial.begin(115200);
    
    Wire.begin();
//    Wire.setClock(400000); // use 400 kHz I2C
    WiFi.begin(ssid, password);
    
    while (WiFi.status() != WL_CONNECTED) {
      delay(1000);
      Serial.println("Connecting..");    
    }
    
    Serial.println("ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");

    server.begin();
    Serial.println("Server started");
    Serial.print("Use this URL to connect: ");
    Serial.print("http://");
    Serial.print(WiFi.localIP());
    Serial.println("/");
    //WIFI ì—°ê²° í›„ íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²° 
    Firebase.begin(FIREBASE_HOST,FIREBASE_Authorization_key);
    Serial.println("Firebase connect");
    //íŒŒì´ì–´ë² ì´ìŠ¤ DB OFFë¡œ ì´ˆê¸°í™”, ì´ˆê¸°ê°’ 0ì„¤ì •
//    Firebase.setString(firebaseData, "/testPump_in_server_DB/AUTO", OFFval);
//    autoval = OFFval; // ì‹œì‘í•  ë•Œ auto OFF
//    pumpval = OFFval; // ì‹œì‘í•  ë•Œ pump OFF
    
    

    //Set the pin mode to output
    pinMode(XSHUT_A ,OUTPUT);
    pinMode(XSHUT_B ,OUTPUT);
    pinMode(XSHUT_C ,OUTPUT);
    pinMode(XSHUT_D ,OUTPUT);
    pinMode(XSHUT_E ,OUTPUT);

    //Turn all TOF's off
    digitalWrite(XSHUT_A, LOW);
    digitalWrite(XSHUT_B, LOW);
    digitalWrite(XSHUT_C, LOW);
    digitalWrite(XSHUT_D, LOW);
    digitalWrite(XSHUT_E, LOW);
  
//ë ˆì´ì € 2M
/////////////////////////////////////////////////////////////////
//  sensor.setTimeout(500);
//  if (!sensor.init())
//  {
//    Serial.println("Failed to detect and initialize sensor!");
//    while (1) {}
//  }
  
  // Start continuous back-to-back mode (take readings as
  // fast as possible).  To use continuous timed mode
  // instead, provide a desired inter-measurement period in
  // ms (e.g. sensor.startContinuous(100)).
  //  sensor.startContinuous();
/////////////////////////////////////////////////////////////////

//    //-----------------------------------------------------------------
//    //FIRST WE WILL CONFIGURE AND SETUP SENSOR_A
//    -----------------------------------------------------------------
    delay(50);
    digitalWrite(XSHUT_A, HIGH); //Turn sensor_A on
    delay(50);
    
    sensor_A.setTimeout(500); //Set the sensors timeout
    
    if (!sensor_A.init())//try to initilise the sensor
    {
        //Sensor does not respond within the timeout time
        Serial.println("Sensor_A is not responding, check your wiring");
    }
    else
    {
        sensor_A.setAddress(42); //Set the sensors I2C address
        sensor_A.setDistanceMode(VL53L1X::Long); //Set the sensor to maximum range of 4 meters
        sensor_A.setMeasurementTimingBudget(4000); //Set its timing budget in microseconds longer timing budgets will give more accurate measurements
        sensor_A.startContinuous(M_INTERVAL); //Sets the interval where a measurement can be requested in milliseconds
    }   
 
//    //-----------------------------------------------------------------
//    //NOW CONFIGURE AND SETUP SENSOR_B
//    //-----------------------------------------------------------------
    delay(50);
    digitalWrite(XSHUT_B, HIGH); //Turn sensor_B on
    delay(50);
    
    sensor_B.setTimeout(500); //Set the sensors timeout
    
    if (!sensor_B.init())//try to initilise the sensor
    {
        //Sensor does not respond within the timeout time
        Serial.println("Sensor_B is not responding, check your wiring");
    }
    else
    {
        sensor_B.setAddress(43); //Set the sensors I2C address
        sensor_B.setDistanceMode(VL53L1X::Long); //Set the sensor to maximum range of 4 meters
        sensor_B.setMeasurementTimingBudget(4000); //Set its timing budget in microseconds longer timing budgets will give more accurate measurements
        sensor_B.startContinuous(M_INTERVAL); //Sets the interval where a measurement can be requested in milliseconds
    }
 
      //-----------------------------------------------------------------
    //NOW CONFIGURE AND SETUP SENSOR_C
    //-----------------------------------------------------------------
    delay(50);
    digitalWrite(XSHUT_C, HIGH); //Turn sensor_C on
    delay(50);
    
    sensor_C.setTimeout(500); //Set the sensors timeout
    
    if (!sensor_C.init())//try to initilise the sensor
    {
        //Sensor does not respond within the timeout time
        Serial.println("Sensor_C is not responding, check your wiring");
    }
    else
    {
        sensor_C.setAddress(44); //Set the sensors I2C address
        sensor_C.setDistanceMode(VL53L1X::Long); //Set the sensor to maximum range of 4 meters
        sensor_C.setMeasurementTimingBudget(4000); //Set its timing budget in microseconds longer timing budgets will give more accurate measurements
        sensor_C.startContinuous(M_INTERVAL); //Sets the interval where a measurement can be requested in milliseconds
    } 
 
    //-----------------------------------------------------------------
    //NOW CONFIGURE AND SETUP SENSOR_D
    //-----------------------------------------------------------------
    delay(50);
    digitalWrite(XSHUT_D, HIGH); //Turn sensor_D on
    delay(50);
    
    sensor_D.setTimeout(500); //Set the sensors timeout
    
    if (!sensor_D.init())//try to initilise the sensor
    {
        //Sensor does not respond within the timeout time
        Serial.println("Sensor_D is not responding, check your wiring");
    }
    else
    {
        sensor_D.setAddress(45); //Set the sensors I2C address
        sensor_D.setDistanceMode(VL53L1X::Long); //Set the sensor to maximum range of 4 meters
        sensor_D.setMeasurementTimingBudget(4000); //Set its timing budget in microseconds longer timing budgets will give more accurate measurements
        sensor_D.startContinuous(M_INTERVAL); //Sets the interval where a measurement can be requested in milliseconds
    }

     //-----------------------------------------------------------------
    //NOW CONFIGURE AND SETUP SENSOR_E
    //-----------------------------------------------------------------
    delay(50);
    digitalWrite(XSHUT_E, HIGH); //Turn sensor_E on
    delay(50);
    
    sensor_E.setTimeout(500); //Set the sensors timeout
    
    if (!sensor_E.init())//try to initilise the sensor
    {
        //Sensor does not respond within the timeout time
        Serial.println("Sensor_E is not responding, check your wiring");
    }
    else
    {
        sensor_E.setAddress(46); //Set the sensors I2C address
        sensor_E.setDistanceMode(VL53L1X::Long); //Set the sensor to maximum range of 4 meters
        sensor_E.setMeasurementTimingBudget(4000); //Set its timing budget in microseconds longer timing budgets will give more accurate measurements
        sensor_E.startContinuous(M_INTERVAL); //Sets the interval where a measurement can be requested in milliseconds
    }
     
}//setup


void loop() {  
  WiFiClient client = server.available();
  
// ë ˆì´ì € 2M ì§œë¦¬
//    int laser1 = sensor.readRangeContinuousMillimeters();   
     
  int laser1 = sensor_A.read();
  int laser2 = sensor_B.read();
  int laser3 = sensor_C.read();
  int laser4 = sensor_D.read();
  int laser5 = sensor_E.read();

  Serial.print("laser1 : ");
  Serial.println(laser1);
  Serial.print("laser2 : ");
  Serial.println(laser2);
  Serial.print("laser3 : ");
  Serial.println(laser3);
  Serial.print("laser4: ");
  Serial.println(laser4);
  Serial.print("laser5 : ");
  Serial.println(laser5);

  //í‰ê· 
  avg = (laser1 + laser2 + laser3 + laser4 + laser5)/5;
//  avg = (laser1 + laser2 + laser4 + laser5)/4;
//    avg = laser5;
//   avg = laser3;
//    avg = laser2;
//    avg = laser1;
//    avg = (laser1 + laser2 + laser4)/3;
  Serial.print("í‰ê·  : ");
  Serial.println(avg);
  //Firebase ë°ì´í„°ë² ì´ìŠ¤ì— ë ˆì´ì ¸ í‰ê·  ê±°ë¦¬ê°’ ì €ì¥(ì‹¤ì‹œê°„)
  Firebase.setFloat(firebaseData, "/testPump_in_server_DB/DISTANCE", avg);
  delay(1500);
//    Data ì—…ë¡œë“œ ë° ì‹œê°í™”í•˜ê¸° ìœ„í•œ ì½”ë“œ 

//    ì„¼ì„œ ì—†ì´ ë…¸ë§ íŒí”„ ì‚¬ìš©í•  ë•Œ
//      Firebase.setFloat(firebaseData, "/database_test/Normal_pump", avg);
//    Firebase.pushFloat(firebaseData, "/database_test/Normal_pump", avg);

//    ë ˆì´ì €ì„¼ì„œ ë° ì˜¤í† íŒí”„ ì‚¬ìš©í•  ë•Œ
//    Firebase.pushFloat(firebaseData, "/database_test/Auto_pump", avg);
  
  //ë¶„ì‚°
//  int var = (pow((laser1-avg),2) + pow((laser2-avg),2) + pow((laser3-avg),2) + pow((laser4-avg),2) + pow((laser5-avg),2))/5;
//  int var = (pow((laser1-avg),2) + pow((laser2-avg),2) + pow((laser4-avg),2) + pow((laser5-avg),2))/4;
//  int var = (pow((laser1-avg),2) + pow((laser2-avg),2) + pow((laser4-avg),2))/3;
  
  //í‘œì¤€í¸ì°¨
//  int StandDev = sqrt(var);
//  Firebase.setFloat(firebaseData, "/testPump_in_server_DB/STANDARD", StandDev);
//  Serial.print("í‘œì¤€í¸ì°¨ : ");
//  Serial.println(StandDev);
    

} //loop
```
5ê°œì˜ ë ˆì´ì € ì„¼ì„œ í‰ê· ê°’ì„ Firebaseë¡œ ë³´ë‚´ëŠ” ì½”ë“œì´ë‹¤.

### Application - App Inventor
![inventor2](https://user-images.githubusercontent.com/58980007/145999386-4e4cdfd7-8a4a-4342-9a62-4c7a27c2847f.PNG)
![inventor1](https://user-images.githubusercontent.com/58980007/145999483-0095e9e3-127b-4149-9b68-cfc4ae9b1971.PNG)
App Inventorë¥¼ í†µí•´ Applicationì„ ì œì‘í•˜ì˜€ë‹¤.

### Web - index.html
![index](https://user-images.githubusercontent.com/58980007/146000300-ad32b4bb-4355-434b-8034-5ab0cc3b89b7.PNG)

ë©”ì¸ ì‹œìŠ¤í…œ ë° APP ì‘ë™ ì—¬ë¶€ì™€ ìƒíƒœ í™•ì¸ì´ ê°€ëŠ¥í•œ í™ˆí˜ì´ì§€ë‹¤.

### Web - app.js
![app](https://user-images.githubusercontent.com/58980007/146000198-76086454-f646-4b09-8f2d-68da35908952.png)
![firebase](https://user-images.githubusercontent.com/58980007/146000266-84975eb4-ca36-492b-aadb-11698370652b.PNG)

í™ˆí˜ì´ì§€ì—ì„œ Firebaseì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•œ ì†ŒìŠ¤ì´ë‹¤.

### SMS Service Code
![3](https://user-images.githubusercontent.com/58980007/145999893-7f6f9dbb-a3e7-448d-b96c-8f37d2c033f1.PNG)
SMS ì „ì†¡ì„ í•˜ê¸° ìœ„í•œ ì†ŒìŠ¤ì½”ë“œì´ë‹¤.


## 3D Design
![3d](https://user-images.githubusercontent.com/58980007/146006765-3c6f6b63-7992-491e-8442-5a40ba2b6c8b.PNG)


## ì™„ì„±ì‚¬ì§„
### Main System
![Main](https://user-images.githubusercontent.com/58980007/146001744-c7d1b735-e68d-48a5-b9f2-cabb238bf0c0.PNG)

### Laser Sensor
![Laser](https://user-images.githubusercontent.com/58980007/146003161-2e02dd0f-5390-4da5-ab3a-b780ac9ceeff.PNG)

### Application
![ì•±](https://user-images.githubusercontent.com/58980007/146003291-01a3b7d4-38ff-40a7-9daf-6f99c88fa3c2.PNG)

### Web
![WebPage](https://user-images.githubusercontent.com/58980007/146005969-112d15bc-854b-4828-acae-9df68e256653.PNG)

### SMS
![SMS](https://user-images.githubusercontent.com/58980007/146004098-4f9075f2-7573-4192-9899-3969d9dc244b.jpg)
